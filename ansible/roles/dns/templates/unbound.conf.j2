# aegis-node/ansible/roles/dns/templates/unbound.conf.j2'

server:
    interface: {{ dns_listen_address }}
    port: {{ dns_listen_port }}

    # Network protocols (disable IPv6 if disabled in kernel to prevent crash)
    do-ip4: yes
    do-ip6: {{ 'yes' if wg_enable_ipv6 else 'no' }}
    do-udp: yes
    do-tcp: yes

    # Ubuntu default trust anchor for DNSSEC
    auto-trust-anchor-file: "/var/lib/unbound/root.key"

    access-control: {{ dns_allowed_subnet }} allow

    verbosity: 0
    hide-identity: yes
    hide-version: yes

    qname-minimisation: yes
    harden-glue: yes
    harden-dnssec-stripped: yes

    cache-min-ttl: 3600
    cache-max-ttl: 86400

    prefetch: yes

forward-zone:
    name: "."
{% for addr in dns_upstream_servers %}
    forward-addr: {{ addr }}
{% endfor %}